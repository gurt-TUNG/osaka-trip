import React, { useState, useEffect } from 'react';
import { 
  Calendar, MapPin, Info, CheckCircle, XCircle, Activity, 
  Train, Plane, Utensils, Star, Baby, ExternalLink, 
  Edit3, Save, Plus, Trash2, Home, Settings, DollarSign, List,
  BookOpen, MessageCircle, Volume2, ShoppingBag, Hash, RefreshCw, PlayCircle,
  Hotel, AlertTriangle
} from 'lucide-react';

// --- èªéŸ³åˆæˆ Helper ---
const speakJapanese = (text) => {
  if (!window.speechSynthesis) {
    alert("æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³åŠŸèƒ½");
    return;
  }
  // å–æ¶ˆæ­£åœ¨æ’­æ”¾çš„èªéŸ³ï¼Œé¿å…é‡ç–Š
  window.speechSynthesis.cancel();

  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = 'ja-JP'; // è¨­å®šèªè¨€ç‚ºæ—¥æ–‡
  utterance.rate = 0.9; // ç¨å¾®æ”¾æ…¢èªé€Ÿé©åˆå°æœ‹å‹è½
  utterance.pitch = 1.1; // ç¨å¾®æé«˜éŸ³èª¿æ¯”è¼ƒæœ‰æ´»åŠ›
  
  window.speechSynthesis.speak(utterance);
};

// --- æ—¥èªå­¸ç¿’è³‡æ–™åº« (åˆ†é¡ç€è¦½ç”¨) ---
const LEARNING_DATA = [
  {
    id: 'basic',
    category: "åŸºæœ¬ç¦®è²Œ",
    color: "bg-green-100 text-green-700",
    words: [
      { ch: "ä½ å¥½", en: "Hello", jp: "ã“ã‚“ã«ã¡ã¯", romaji: "Kon-nichi-wa" },
      { ch: "è¬è¬", en: "Thank you", jp: "ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™", romaji: "A-ri-ga-tou go-zai-ma-su" }, 
      { ch: "å°ä¸èµ·", en: "Sorry", jp: "ã”ã‚ã‚“ãªã•ã„", romaji: "Go-men-na-sai" },
      { ch: "å»æ‰€", en: "Toilet", jp: "ãƒˆã‚¤ãƒ¬", romaji: "To-i-re" }
    ],
    phrase: { ch: "è«‹å•å»æ‰€åœ¨å“ªè£¡ï¼Ÿ", jp: "ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹ï¼Ÿ", romaji: "Toire wa doko desu ka?" } 
  },
  {
    id: 'transport',
    category: "äº¤é€šæ¢éšª",
    color: "bg-blue-100 text-blue-700",
    words: [
      { ch: "é›»è»Š", en: "Train", jp: "ã§ã‚“ã—ã‚ƒ", romaji: "Den-sha" },
      { ch: "è»Šç«™", en: "Station", jp: "ãˆã", romaji: "E-ki" },
      { ch: "ç¥¨", en: "Ticket", jp: "ãã£ã·", romaji: "Kip-pu" },
      { ch: "åˆ°äº†", en: "Arrived", jp: "ã¤ãã¾ã—ãŸ", romaji: "Tsu-ki-ma-shi-ta" } 
    ],
    phrase: { ch: "é€™å€‹å»å¤§é˜ªå—ï¼Ÿ", jp: "ã“ã‚Œã¯ãŠãŠã•ã‹ã«è¡Œãã¾ã™ã‹ï¼Ÿ", romaji: "Kore wa Osaka ni ikimasu ka?" }
  },
  {
    id: 'hotel', // æ–°å¢åˆ†é¡
    category: "é£¯åº—ä½å®¿",
    color: "bg-indigo-100 text-indigo-700",
    words: [
      { ch: "æˆ¿é–“", en: "Room", jp: "ã¸ã‚„", romaji: "He-ya" },
      { ch: "é‘°åŒ™", en: "Key", jp: "ã‹ã", romaji: "Ka-gi" },
      { ch: "æ¯›å·¾", en: "Towel", jp: "ã‚¿ã‚ªãƒ«", romaji: "Ta-o-ru" },
      { ch: "æ—©é¤", en: "Breakfast", jp: "ã¡ã‚‡ã†ã—ã‚‡ã", romaji: "Chou-sho-ku" }
    ],
    phrase: { ch: "æˆ‘è¦è¾¦ç†å…¥ä½", jp: "ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ãŠã­ãŒã„ã—ã¾ã™", romaji: "Check-in onegai shimasu" }
  },
  {
    id: 'shopping',
    category: "é€›è¡—è³¼ç‰©",
    color: "bg-purple-100 text-purple-700",
    words: [
      { ch: "å¤šå°‘éŒ¢", en: "How much", jp: "ã„ãã‚‰ã§ã™ã‹", romaji: "I-ku-ra de-su-ka" }, 
      { ch: "è¢‹å­", en: "Bag", jp: "ãµãã‚", romaji: "Fu-ku-ro" },
      { ch: "æƒ³è¦", en: "Want", jp: "ã»ã—ã„ã§ã™", romaji: "Ho-shi-i de-su" }, 
      { ch: "ä¸ç”¨äº†", en: "No thanks", jp: "ã‘ã£ã“ã†ã§ã™", romaji: "Kek-kou de-su" }
    ],
    phrase: { ch: "è«‹çµ¦æˆ‘è¢‹å­", jp: "ãµãã‚ã‚’ãã ã•ã„", romaji: "Fukuro o kudasai" }
  },
  {
    id: 'usj',
    category: "ç’°çƒå½±åŸ",
    color: "bg-red-100 text-red-700",
    words: [
      { ch: "ç‘ªåˆ©æ­", en: "Mario", jp: "ãƒãƒªã‚ª", romaji: "Ma-ri-o" },
      { ch: "çˆ†ç±³èŠ±", en: "Popcorn", jp: "ãƒãƒƒãƒ—ã‚³ãƒ¼ãƒ³", romaji: "Pop-pu-ko-on" },
      { ch: "å¥½ç©", en: "Fun", jp: "ãŸã®ã—ã„ã§ã™", romaji: "Ta-no-shi-i de-su" }, 
      { ch: "æ’éšŠ", en: "Line up", jp: "ãªã‚‰ã³ã¾ã™", romaji: "Na-ra-bi-ma-su" } 
    ],
    phrase: { ch: "æˆ‘æƒ³ç©é€™å€‹ï¼", jp: "ã“ã‚Œã«ã®ã‚ŠãŸã„ã§ã™ï¼", romaji: "Kore ni noritai desu!" } 
  },
  {
    id: 'food',
    category: "é¤å»³é»é¤",
    color: "bg-orange-100 text-orange-700",
    words: [
      { ch: "æ°´", en: "Water", jp: "ãŠã¿ãš", romaji: "O-mi-zu" },
      { ch: "å¥½å–", en: "Yummy", jp: "ãŠã„ã—ã„ã§ã™", romaji: "O-i-shi-i de-su" }, 
      { ch: "é€™å€‹", en: "This one", jp: "ã“ã‚Œ", romaji: "Ko-re" },
      { ch: "çµå¸³", en: "Check", jp: "ãŠã‹ã„ã‘ã„", romaji: "O-kai-kei" }
    ],
    phrase: { ch: "è«‹çµ¦æˆ‘é€™å€‹ (æŒ‡åœ–ç‰‡)", jp: "ã“ã‚Œãã ã•ã„", romaji: "Kore kudasai" }
  },
  {
    id: 'nara',
    category: "å¥ˆè‰¯èˆ‡å‹•ç‰©",
    color: "bg-yellow-100 text-yellow-700",
    words: [
      { ch: "é¹¿", en: "Deer", jp: "ã—ã‹", romaji: "Shi-ka" },
      { ch: "ä»™è²", en: "Cracker", jp: "ã›ã‚“ã¹ã„", romaji: "Sen-bei" },
      { ch: "å¯æ„›", en: "Cute", jp: "ã‹ã‚ã„ã„ã§ã™", romaji: "Ka-wa-i-i de-su" }, 
      { ch: "ç—›ï¼", en: "Ouch", jp: "ã„ãŸã„ã§ã™", romaji: "I-ta-i de-su" } 
    ],
    phrase: { ch: "ä¸è¡Œå–”ï¼(å°é¹¿èªª)", jp: "ã ã‚ã§ã™ã‚ˆï¼", romaji: "Da-me de-su-yo!" } 
  },
  {
    id: 'emergency', // æ–°å¢åˆ†é¡
    category: "ç·Šæ€¥æ±‚åŠ©",
    color: "bg-gray-100 text-gray-700",
    words: [
      { ch: "å¹«å¿™", en: "Help", jp: "ãŸã™ã‘ã¦", romaji: "Ta-su-ke-te" },
      { ch: "è¿·è·¯", en: "Lost", jp: "ã¾ã„ã”", romaji: "Ma-i-go" },
      { ch: "è­¦å¯Ÿ", en: "Police", jp: "ã‘ã„ã•ã¤", romaji: "Ke-i-sa-tsu" },
      { ch: "é†«é™¢", en: "Hospital", jp: "ã³ã‚‡ã†ã„ã‚“", romaji: "Byou-in" }
    ],
    phrase: { ch: "æˆ‘è¿·è·¯äº†", jp: "ã¾ã„ã”ã«ãªã‚Šã¾ã—ãŸ", romaji: "Maigo ni narimashita" }
  }
];

// --- æ¯æ—¥ä¸€å¥æ“´å……è‡³ 66 å¥ (å…¨æ–¹ä½æ—…éŠç‰ˆ) ---
const DAILY_PHRASES = [
  // 1. è¬ç”¨ç¦®è²Œé‡‘å¥ (8å¥)
  { ch: "è¬è¬ï¼", jp: "ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼", romaji: "A-ri-ga-tou go-zai-ma-su!", desc: "è¶…ç´šæœ‰ç¦®è²Œçš„èªªæ³•ï¼Œå¤§å®¶æœƒå¾ˆå–œæ­¡ä½ ã€‚" },
  { ch: "ä½ å¥½ï¼", jp: "ã“ã‚“ã«ã¡ã¯ï¼", romaji: "Kon-nichi-wa!", desc: "ç™½å¤©çš„æ‰“æ‹›å‘¼ã€‚" },
  { ch: "æ—©å®‰ï¼", jp: "ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ï¼", romaji: "O-ha-you go-zai-ma-su!", desc: "æ—©ä¸Šè·Ÿé£¯åº—çš„äººæˆ–åº—å“¡æ‰“æ‹›å‘¼ç”¨ã€‚" },
  { ch: "æ™šå®‰ï¼", jp: "ãŠã‚„ã™ã¿ãªã•ã„ï¼", romaji: "O-ya-su-mi na-sa-i!", desc: "ç¡è¦ºå‰è·Ÿå®¶äººèªªã€‚" },
  { ch: "ä¸å¥½æ„æ€...", jp: "ã™ã¿ã¾ã›ã‚“...", romaji: "Su-mi-ma-sen", desc: "è¦å«åº—å“¡ã€å€Ÿéã€æˆ–æ˜¯ç¨å¾®æ’åˆ°äººæ™‚éƒ½å¯ä»¥ç”¨ã€‚" },
  { ch: "æ‹œè¨—ä½ äº†", jp: "ãŠã­ãŒã„ã—ã¾ã™", romaji: "O-ne-ga-i-shi-ma-su", desc: "é»é¤æˆ–è«‹æ±‚å¹«åŠ©æ™‚å¥å°¾åŠ ä¸Šé€™å¥ã€‚" },
  { ch: "æ²’é—œä¿‚", jp: "ã ã„ã˜ã‚‡ã†ã¶ã§ã™", romaji: "Dai-jou-bu de-su", desc: "åˆ¥äººè·Ÿä½ é“æ­‰ï¼Œæˆ–æ˜¯å•ä½ å¥½ä¸å¥½çš„æ™‚å€™ã€‚" },
  { ch: "å†è¦‹ï¼", jp: "ã•ã‚ˆã†ãªã‚‰ï¼", romaji: "Sa-you-na-ra!", desc: "è·Ÿæ–°èªè­˜çš„æœ‹å‹èªªæ°æ°ã€‚" },

  // 2. æ©Ÿå ´èˆ‡äº¤é€š (10å¥)
  { ch: "é€™å€‹å»å¤§é˜ªå—ï¼Ÿ", jp: "ã“ã‚Œã¯ãŠãŠã•ã‹ã«è¡Œãã¾ã™ã‹ï¼Ÿ", romaji: "Kore wa Osaka ni ikimasu ka?", desc: "ç¢ºèªé›»è»Šæ–¹å‘ã€‚" },
  { ch: "é€™å€‹å»ä¸‰å®®å—ï¼Ÿ", jp: "ã“ã‚Œã¯ã•ã‚“ã®ã¿ã‚„ã«è¡Œãã¾ã™ã‹ï¼Ÿ", romaji: "Kore wa Sannomiya ni ikimasu ka?", desc: "ç¥æˆ¶æ©Ÿå ´æ­è»Šæ™‚ç”¨ã€‚" },
  { ch: "è»Šç«™å“ªè£¡ï¼Ÿ", jp: "ãˆãã¯ã©ã“ã§ã™ã‹ï¼Ÿ", romaji: "E-ki wa do-ko de-su-ka?", desc: "è¿·è·¯æ‰¾è»Šç«™æ™‚ã€‚" },
  { ch: "è«‹çµ¦æˆ‘åœ°åœ–", jp: "ã¡ãšã‚’ãã ã•ã„", romaji: "Chi-zu o ku-da-sa-i", desc: "åœ¨éŠå®¢ä¸­å¿ƒè¦åœ°åœ–ã€‚" },
  { ch: "é€™ç­æ˜¯å¿«é€Ÿé›»è»Šå—ï¼Ÿ", jp: "ã“ã‚Œã¯ã‹ã„ããã§ã™ã‹ï¼Ÿ", romaji: "Kore wa kaisoku desu ka?", desc: "æ€•æ­åˆ°æ¯ç«™åœçš„æ…¢è»Šæ™‚å•ã€‚" },
  { ch: "å”®ç¥¨è™•åœ¨å“ªè£¡ï¼Ÿ", jp: "ãã£ã·ã†ã‚Šã°ã¯ã©ã“ã§ã™ã‹ï¼Ÿ", romaji: "Kippu uriba wa doko desu ka?", desc: "è¦è²·ç¥¨çš„æ™‚å€™ã€‚" },
  { ch: "æˆ‘è¦å„²å€¼(ICå¡)", jp: "ãƒãƒ£ãƒ¼ã‚¸ã—ãŸã„ã§ã™", romaji: "Cha-ji shi-ta-i de-su", desc: "è¥¿ç“œå¡/ICOCAæ²’éŒ¢çš„æ™‚å€™ã€‚" },
  { ch: "è«‹è¼‰æˆ‘å»é€™è£¡", jp: "ã“ã“ã«è¡Œã£ã¦ãã ã•ã„", romaji: "Koko ni itte kudasai", desc: "çµ¦è¨ˆç¨‹è»Šå¸æ©Ÿçœ‹åœ°å€æ™‚èªªã€‚" },
  { ch: "å¤§æ¦‚å¤šä¹…ï¼Ÿ", jp: "ã©ã®ãã‚‰ã„ã‹ã‹ã‚Šã¾ã™ã‹ï¼Ÿ", romaji: "Dono kurai kakarimasu ka?", desc: "å•è»Šç¨‹æ™‚é–“ã€‚" },
  { ch: "é›»æ¢¯åœ¨å“ªè£¡ï¼Ÿ", jp: "ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼ã¯ã©ã“ã§ã™ã‹ï¼Ÿ", romaji: "Erebila wa doko desu ka?", desc: "æ¨è¡Œææˆ–æ¨è»Šæ‰¾é›»æ¢¯å¿…å‚™ã€‚" },

  // 3. é£¯åº—ä½å®¿ (8å¥)
  { ch: "æˆ‘è¦è¾¦ç†å…¥ä½", jp: "ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ãŠã­ãŒã„ã—ã¾ã™", romaji: "Check-in onegai shimasu", desc: "åˆ°é£¯åº—æ«ƒæª¯ç¬¬ä¸€å¥è©±ã€‚" },
  { ch: "æˆ‘è¦é€€æˆ¿", jp: "ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆãŠã­ãŒã„ã—ã¾ã™", romaji: "Check-out onegai shimasu", desc: "é›¢é–‹é£¯åº—æ™‚èªªã€‚" },
  { ch: "å¯ä»¥å¯„æ”¾è¡Œæå—ï¼Ÿ", jp: "ã«ã‚‚ã¤ã‚’ã‚ãšã‹ã£ã¦ã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿ", romaji: "Nimotsu o azukatte moraemasu ka?", desc: "é‚„æ²’åˆ°å…¥ä½æ™‚é–“æƒ³å…ˆæ”¾è¡Œæã€‚" },
  { ch: "æ—©é¤å¹¾é»é–‹å§‹ï¼Ÿ", jp: "ã¡ã‚‡ã†ã—ã‚‡ãã¯ãªã‚“ã˜ã§ã™ã‹ï¼Ÿ", romaji: "Choushoku wa nanji desu ka?", desc: "ç¢ºèªæ—©é¤æ™‚é–“ã€‚" },
  { ch: "è«‹çµ¦æˆ‘æ¯›å·¾", jp: "ã‚¿ã‚ªãƒ«ã‚’ãã ã•ã„", romaji: "Taoru o kudasai", desc: "æ¯›å·¾ä¸å¤ æ™‚ã€‚" },
  { ch: "æœ‰Wi-Fiå—ï¼Ÿ", jp: "Wi-Fi ã‚ã‚Šã¾ã™ã‹ï¼Ÿ", romaji: "Wi-Fi a-ri-ma-su-ka?", desc: "å•å¯†ç¢¼ã€‚" },
  { ch: "è«‹çµ¦æˆ‘æˆ¿å¡", jp: "ã‚«ãƒ¼ãƒ‰ã‚­ãƒ¼ã‚’ãã ã•ã„", romaji: "Card key o kudasai", desc: "æˆ¿å¡éºå¤±æˆ–éœ€è¦å¤šä¸€å¼µæ™‚ã€‚" },
  { ch: "é™„è¿‘æœ‰ä¾¿åˆ©å•†åº—å—ï¼Ÿ", jp: "ã¡ã‹ãã«ã‚³ãƒ³ãƒ“ãƒ‹ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ", romaji: "Chikaku ni konbini wa arimasu ka?", desc: "æ™šä¸Šæƒ³è²·é›¶é£Ÿã€‚" },

  // 4. äº«å—ç¾é£Ÿ (10å¥)
  { ch: "è«‹çµ¦æˆ‘é€™å€‹ï¼", jp: "ã“ã‚Œãã ã•ã„ï¼", romaji: "Kore kudasai!", desc: "è¬ç”¨é»é¤å¥ã€‚" },
  { ch: "å¥½å¥½åƒï¼", jp: "ãŠã„ã—ã„ã§ã™ï¼", romaji: "O-i-shi-i de-su!", desc: "è®šç¾å»šå¸«ã€‚" },
  { ch: "æˆ‘è¦é–‹å‹•äº†ï¼", jp: "ã„ãŸã ãã¾ã™ï¼", romaji: "I-ta-da-ki-ma-su", desc: "é–‹å‹•å‰å¿…èªªã€‚" },
  { ch: "æˆ‘åƒé£½äº†ï¼", jp: "ã”ã¡ãã†ã•ã¾ã§ã—ãŸï¼", romaji: "Go-chi-sou-sa-ma de-shi-ta", desc: "åƒå®Œé›¢å¸­æ™‚èªªã€‚" },
  { ch: "è«‹çµ¦æˆ‘æ°´", jp: "ãŠã¿ãšãã ã•ã„", romaji: "O-mi-zu ku-da-sa-i", desc: "å£æ¸´æ™‚ã€‚" },
  { ch: "æœ‰å…’ç«¥æ¤…å—ï¼Ÿ", jp: "ã“ã©ã‚‚ã‚ˆã†ã®ã„ã™ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ", romaji: "Kodomo you no isu wa arimasu ka?", desc: "å¸¶å°æœ‹å‹ç”¨é¤å¿…å•ã€‚" },
  { ch: "è«‹çµ¦æˆ‘å°ç¢—", jp: "ã¨ã‚Šã–ã‚‰ã‚’ãã ã•ã„", romaji: "Torizara o kudasai", desc: "åˆ†é£Ÿçµ¦å°æœ‹å‹ç”¨çš„å°ç›¤å­æˆ–ç¢—ã€‚" },
  { ch: "ä¸è¦åŠ å±±è‘µ(å“‡æ²™ç±³)", jp: "ã‚ã•ã³ã¬ãã§ãŠã­ãŒã„ã—ã¾ã™", romaji: "Wasabi nuki de onegai shimasu", desc: "å°æœ‹å‹åƒå£½å¸å¿…å‚™ã€‚" },
  { ch: "ä¸è¦å†°å¡Š", jp: "ã“ãŠã‚Šãªã—ã§", romaji: "Koori nashi de", desc: "æ„Ÿå†’æˆ–ä¸æƒ³å–å¤ªå†°ã€‚" },
  { ch: "æˆ‘è¦çµå¸³", jp: "ãŠã‹ã„ã‘ã„ãŠã­ãŒã„ã—ã¾ã™", romaji: "O-kai-kei onegai shimasu", desc: "åƒé£½ä»˜éŒ¢å›‰ã€‚" },

  // 5. å¿«æ¨‚è³¼ç‰© (10å¥)
  { ch: "å¤šå°‘éŒ¢ï¼Ÿ", jp: "ã„ãã‚‰ã§ã™ã‹ï¼Ÿ", romaji: "I-ku-ra de-su-ka?", desc: "è²·æ±è¥¿ç¬¬ä¸€å¥ã€‚" },
  { ch: "æˆ‘æœ‰é€™å¼µå¡(æŒ‡)", jp: "ã“ã®ã‚«ãƒ¼ãƒ‰ã¯ã¤ã‹ãˆã¾ã™ã‹ï¼Ÿ", romaji: "Kono kado wa tsukaemasu ka?", desc: "ç¢ºèªèƒ½ä¸èƒ½åˆ·å¡æˆ–ç”¨å„ªæƒ åˆ¸ã€‚" },
  { ch: "å¯ä»¥å…ç¨…å—ï¼Ÿ", jp: "ã‚ã‚“ãœã„ã§ãã¾ã™ã‹ï¼Ÿ", romaji: "Menzei dekimasu ka?", desc: "å¤§æ¡è³¼æ™‚è¨˜å¾—å•ã€‚" },
  { ch: "æœ‰æ–°çš„å—ï¼Ÿ", jp: "ã‚ãŸã‚‰ã—ã„ã®ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ", romaji: "Atarashii no wa arimasu ka?", desc: "æƒ³æ‹¿åº«å­˜æ–°å“ã€‚" },
  { ch: "å¯ä»¥è©¦ç©¿å—ï¼Ÿ", jp: "ã—ã¡ã‚ƒãã§ãã¾ã™ã‹ï¼Ÿ", romaji: "Shichaku dekimasu ka?", desc: "è²·è¡£æœé‹å­ç”¨ã€‚" },
  { ch: "è«‹çµ¦æˆ‘è¢‹å­", jp: "ãµãã‚ã‚’ãã ã•ã„", romaji: "Fukuro o kudasai", desc: "é›–ç„¶å¯èƒ½è¦éŒ¢ï¼Œä½†éœ€è¦æ™‚å°±èªªã€‚" },
  { ch: "é€™æ˜¯ä»€éº¼ï¼Ÿ", jp: "ã“ã‚Œã¯ãªã‚“ã§ã™ã‹ï¼Ÿ", romaji: "Ko-re wa nan de-su-ka?", desc: "å¥½å¥‡å¯¶å¯¶ã€‚" },
  { ch: "å¤ªå¯æ„›äº†ï¼", jp: "ã‹ã‚ã„ã„ã§ã™ï¼", romaji: "Ka-wa-i-i de-su!", desc: "çœ‹åˆ°å–œæ­¡çš„æ±è¥¿ã€‚" },
  { ch: "å¥½ä¾¿å®œï¼", jp: "ã‚„ã™ã„ã§ã™ã­ï¼", romaji: "Yasui desu ne!", desc: "ç™¼ç¾ç‰¹åƒ¹å“ã€‚" },
  { ch: "è«‹çµ¦æˆ‘æ”¶æ“š", jp: "ãƒ¬ã‚·ãƒ¼ãƒˆã‚’ãã ã•ã„", romaji: "Reshito o kudasai", desc: "è¨˜å¸³éœ€è¦ã€‚" },

  // 6. æ™¯é»èˆ‡éŠç© (USJ/å¥ˆè‰¯) (10å¥)
  { ch: "å»æ‰€åœ¨å“ªè£¡ï¼Ÿ", jp: "ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹ï¼Ÿ", romaji: "To-i-re wa do-ko de-su-ka?", desc: "æœ€é‡è¦çš„å¥å­ã€‚" },
  { ch: "æˆ‘æƒ³ç©é€™å€‹ï¼", jp: "ã“ã‚Œã«ã®ã‚ŠãŸã„ã§ã™ï¼", romaji: "Kore ni noritai desu!", desc: "æŒ‡è‘—éŠæ¨‚è¨­æ–½èªªã€‚" },
  { ch: "è¦æ’å¤šä¹…ï¼Ÿ", jp: "ã©ã®ãã‚‰ã„ã¾ã¡ã¾ã™ã‹ï¼Ÿ", romaji: "Dono kurai machimasu ka?", desc: "å•å·¥ä½œäººå“¡ç­‰å¾…æ™‚é–“ã€‚" },
  { ch: "å¯ä»¥æ‹ç…§å—ï¼Ÿ", jp: "ã—ã‚ƒã—ã‚“ OKã§ã™ã‹ï¼Ÿ", romaji: "Sha-shin OK de-su-ka?", desc: "æƒ³æ‹äººå¶æˆ–åº—å…§ã€‚" },
  { ch: "å¯ä»¥å¹«æˆ‘å€‘æ‹ç…§å—ï¼Ÿ", jp: "ã—ã‚ƒã—ã‚“ã‚’ã¨ã£ã¦ã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿ", romaji: "Shashin o totte moraemasu ka?", desc: "è«‹è·¯äººå¹«å…¨å®¶åˆç…§ã€‚" },
  { ch: "å…©ä½(äººæ•¸)", jp: "ãµãŸã‚Šã§ã™", romaji: "Futari desu", desc: "é€²é¤å»³æˆ–ç©è¨­æ–½å ±äººæ•¸ã€‚" },
  { ch: "å¯ä»¥å†å…¥å ´å—ï¼Ÿ", jp: "ã•ã„ã«ã‚…ã†ã˜ã‚‡ã†ã§ãã¾ã™ã‹ï¼Ÿ", romaji: "Sainyuujou dekimasu ka?", desc: "æƒ³æš«æ™‚å‡ºåœ’å€æ™‚å•ã€‚" },
  { ch: "å¥½ç©ï¼", jp: "ãŸã®ã—ã„ã§ã™ï¼", romaji: "Ta-no-shi-i de-su!", desc: "ç©å¾—é–‹å¿ƒå¤§è²èªªã€‚" },
  { ch: "å¥½å²å®³ï¼", jp: "ã™ã”ã„ã§ã™ã­ï¼", romaji: "Su-go-i de-su-ne!", desc: "çœ‹éŠè¡Œæˆ–è¡¨æ¼”æ™‚ã€‚" },
  { ch: "å¤ªå¥½äº†/è€¶ï¼", jp: "ã‚„ã£ãŸãƒ¼ï¼", romaji: "Yat-ta!", desc: "æŠ½åˆ°æ‰­è›‹æˆ–è´å¾—éŠæˆ²ã€‚" },

  // 7. ç·Šæ€¥èˆ‡æ±‚åŠ© (10å¥)
  { ch: "æˆ‘ä¸èˆ’æœ...", jp: "ãã¶ã‚“ãŒã‚ã‚‹ã„ã§ã™...", romaji: "Ki-bun ga wa-ru-i de-su", desc: "æƒ³åæˆ–é ­æšˆæ™‚ã€‚" },
  { ch: "å¥½ç—›ï¼", jp: "ã„ãŸã„ã§ã™ï¼", romaji: "I-ta-i de-su!", desc: "å—å‚·æ™‚ã€‚" },
  { ch: "è«‹å¹«å¹«æˆ‘ï¼", jp: "ãŸã™ã‘ã¦ãã ã•ã„ï¼", romaji: "Ta-su-ke-te ku-da-sa-i!", desc: "é‡åˆ°å›°é›£æ™‚ã€‚" },
  { ch: "æˆ‘è¿·è·¯äº†", jp: "ã¾ã„ã”ã«ãªã‚Šã¾ã—ãŸ", romaji: "Maigo ni narimashita", desc: "æ‰¾ä¸åˆ°è·¯æ™‚ã€‚" },
  { ch: "å°å­©èµ°ä¸Ÿäº†", jp: "ã“ã©ã‚‚ãŒã¾ã„ã”ã§ã™", romaji: "Kodomo ga maigo desu", desc: "æœ€ç·Šæ€¥çš„æƒ…æ³ï¼Œæ‰¾å·¥ä½œäººå“¡ã€‚" },
  { ch: "æˆ‘è½ä¸æ‡‚", jp: "ã‚ã‹ã‚Šã¾ã›ã‚“", romaji: "Wa-ka-ri-ma-sen", desc: "å°æ–¹èªªå¤ªå¿«æ™‚ã€‚" },
  { ch: "è«‹èªªæ…¢ä¸€é»", jp: "ã‚†ã£ãã‚ŠãŠã­ãŒã„ã—ã¾ã™", romaji: "Yukkuri onegai shimasu", desc: "è«‹å°æ–¹æ”¾æ…¢é€Ÿåº¦ã€‚" },
  { ch: "è‹±æ–‡ OKï¼Ÿ", jp: "ãˆã„ã” OKã§ã™ã‹ï¼Ÿ", romaji: "E-i-go OK de-su-ka?", desc: "æƒ³æ”¹ç”¨è‹±æ–‡æºé€šã€‚" },
  { ch: "æˆ‘æœ‰éæ•", jp: "ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ãŒã‚ã‚Šã¾ã™", romaji: "Arerugi ga arimasu", desc: "åƒé£¯æ™‚å‘ŠçŸ¥åº—å“¡ã€‚" },
  { ch: "è«‹ç­‰ä¸€ä¸‹", jp: "ã¡ã‚‡ã£ã¨ã¾ã£ã¦ãã ã•ã„", romaji: "Chot-to mat-te ku-da-sa-i", desc: "æ‰¾æ±è¥¿æˆ–è·Ÿå®¶äººè¨è«–æ™‚ã€‚" }
];

// --- åˆå§‹è³‡æ–™ (æ¨¡æ“¬å¾Œç«¯ API) ---

const INITIAL_ITINERARY_DATA = [
  {
    day: 1,
    date: "2026/04/18",
    weekday: "é€±å…­",
    title: "æŠµé”ç¥æˆ¶èˆ‡ç§»å‹•è‡³å¤§é˜ª",
    intensity: "medium", 
    intensityScore: 5,
    location: "Kobe Airport", 
    displayLocation: "ç¥æˆ¶æ©Ÿå ´ -> å¤§é˜ªå¸‚å€",
    desc: "10:30 æŠµé”ç¥æˆ¶æ©Ÿå ´ (UKB)ã€‚æ­ä¹˜ Port Liner è‡³ä¸‰å®®ç«™ï¼Œè½‰è»Šå‰å¾€å¤§é˜ª(é›£æ³¢/æ¢…ç”°)ã€‚Check-in å¾Œæ¡è²·é›¶é£Ÿã€‚",
    userNotes: "", 
    meals: {
      breakfast: "æ©Ÿä¸Š",
      lunch: "ç¥æˆ¶ä¸‰å®®/å¤§é˜ªå¸‚å€",
      dinner: "é³¥è²´æ— (å…¨ç†Ÿé£Ÿå±…é…’å±‹)",
      note: "æ™šé¤é¸æ“‡å…¨ç†Ÿä¸²ç‡’ï¼Œç„¡ç”Ÿé£Ÿé¢¨éšªã€‚"
    },
    spots: [
      { name: "ç¥æˆ¶æ©Ÿå ´ (UKB)", type: "transport" },
      { name: "ç§»å‹•è‡³å¤§é˜ª", type: "transport" },
      { name: "ä¾¿åˆ©å•†åº— (æ¡è²·é›¶é£Ÿ)", type: "shopping" }
    ]
  },
  {
    day: 2,
    date: "2026/04/19",
    weekday: "é€±æ—¥",
    title: "å¥ˆè‰¯ï¼šå°é¹¿èˆ‡å¤§ä½›",
    intensity: "medium",
    intensityScore: 7,
    location: "Nara Park",
    displayLocation: "å¥ˆè‰¯å…¬åœ’",
    desc: "æˆ¶å¤–èµ°å‹•ç‚ºä¸»ã€‚é¿é–‹å…‡çŒ›å¤§é¹¿ï¼Œå‰å¾€æ±å¤§å¯ºèˆ‡å°é¹¿äº’å‹•ã€‚",
    userNotes: "",
    meals: {
      breakfast: "ä¾¿åˆ©å•†åº—/é£¯åº—",
      lunch: "å¿—æ´¥é¦™é‡œé£¯ (ç†Ÿé£Ÿ/è»Ÿçˆ›)",
      dinner: "å¸‚å€ç°¡é¤ (çƒé¾éºµ/ä¸¼é£¯)",
      note: "é‡œé£¯æ’éšŠäººå¤šå»ºè­°ææ—©ã€‚"
    },
    spots: [
      { name: "è¿‘éµå¥ˆè‰¯ç«™", type: "transport" },
      { name: "å¥ˆè‰¯å…¬åœ’", type: "outdoor" },
      { name: "æ±å¤§å¯º (å¤§ä½›é¼»å­”é‘½æ´)", type: "temple" }
    ]
  },
  {
    day: 3,
    date: "2026/04/20",
    weekday: "é€±ä¸€",
    title: "ç’°çƒå½±åŸ USJ (å…¨æ—¥)",
    intensity: "high",
    intensityScore: 10,
    location: "Universal Studios Japan",
    displayLocation: "USJ ç’°çƒå½±åŸ",
    desc: "è¶…ç´šä»»å¤©å ‚ä¸–ç•Œä¸»å ´ã€‚å…¨æ—¥æˆ°é¬¥è¡Œç¨‹ï¼Œæ—©å‡ºæ™šæ­¸ã€‚",
    userNotes: "",
    meals: {
      breakfast: "ä¾¿åˆ©å•†åº— (é£¯ç³°)",
      lunch: "åœ’å€è¼•é£Ÿ/é¤å»³ (Snoopy Cafe)",
      dinner: "ä¾¿åˆ©å•†åº— (ç‚¸é›/ä¾¿ç•¶)",
      note: "å…¨æ—¥å°ˆæ³¨éŠç©ï¼Œé¤é£Ÿæ±‚å¿«èˆ‡é£½ã€‚"
    },
    spots: [
      { name: "è¶…ç´šä»»å¤©å ‚ä¸–ç•Œ", type: "play" },
      { name: "å°å°å…µæ¨‚åœ’", type: "play" },
      { name: "ç’°çƒå¥‡å¢ƒ (å°å­©ä¼‘æ¯å€)", type: "relax" }
    ]
  },
  {
    day: 4,
    date: "2026/04/21",
    weekday: "é€±äºŒ",
    title: "äº¬éƒ½éµé“åšç‰©é¤¨ (ç·©è¡)",
    intensity: "low",
    intensityScore: 3,
    location: "Kyoto Railway Museum",
    displayLocation: "äº¬éƒ½æ¢…å°è·¯",
    desc: "USJ éš”æ—¥çš„é«”åŠ›æ¢å¾©æ—¥ã€‚å®¤å…§ç‚ºä¸»ï¼Œå¤šåº§ä½ã€‚",
    userNotes: "",
    meals: {
      breakfast: "é£¯åº—/å’–å•¡å»³",
      lunch: "é¤¨å…§ç«è»Šä¾¿ç•¶",
      dinner: "äº¬éƒ½è»Šç«™æ‹‰éºµå°è·¯",
      note: "æ‹‰éºµé¸æ“‡ä¸è¾£å£å‘³ (è±šéª¨/é†¬æ²¹)ã€‚"
    },
    spots: [
      { name: "äº¬éƒ½éµé“åšç‰©é¤¨", type: "museum" },
      { name: "äº¬éƒ½è»Šç«™ (æµæ°´é›»æ¢¯)", type: "sight" }
    ]
  },
  {
    day: 5,
    date: "2026/04/22",
    weekday: "é€±ä¸‰",
    title: "æµ·éŠé¤¨ + æ¨‚é«˜æ¨‚åœ’",
    intensity: "medium-high",
    intensityScore: 8,
    location: "Osaka Aquarium Kaiyukan",
    displayLocation: "å¤§é˜ªæ¸¯æµ·éŠé¤¨",
    desc: "æ¸¯ç£å€å…¨æ—¥éŠã€‚æµ·éŠé¤¨ä¸‹å¡å¥½èµ°ï¼Œæ¨‚é«˜æ¨‚åœ’å°å­©æœ€æ„›ã€‚",
    userNotes: "",
    meals: {
      breakfast: "ä¾¿åˆ©å•†åº—",
      lunch: "å¤©ä¿å±±ç¾é£Ÿè¡— (å¤§é˜ªç‡’)",
      dinner: "ä¾¿åˆ©å•†åº— (å›é£¯åº—åƒ)",
      note: "ç©åˆ°é–‰é¤¨ï¼Œæ™šé¤éš¨æ„è§£æ±ºã€‚"
    },
    spots: [
      { name: "æµ·éŠé¤¨ (é¯¨é¯Š)", type: "aquarium" },
      { name: "å¤§é˜ªæ¨‚é«˜æ¨‚åœ’ (å®¤å…§)", type: "play" },
      { name: "å¤©ä¿å±±æ‘©å¤©è¼ª", type: "view" }
    ]
  },
  {
    day: 6,
    date: "2026/04/23",
    weekday: "é€±å››",
    title: "äº¬éƒ½ç¶“å…¸æ•£ç­–",
    intensity: "medium",
    intensityScore: 6,
    location: "Kiyomizu-dera",
    displayLocation: "äº¬éƒ½æ¸…æ°´å¯º/ä¼è¦‹",
    desc: "æ„Ÿå—å‚³çµ±æ—¥æœ¬ã€‚ä¼è¦‹ç¨»è·åªèµ°å‰æ®µï¼Œæ¸…æ°´å¯ºæ…¢æ…¢é€›ã€‚",
    userNotes: "",
    meals: {
      breakfast: "ä¾¿åˆ©å•†åº—/é£¯åº—",
      lunch: "æ¹¯è±†è…/è¦ªå­ä¸¼",
      dinner: "è¿´è½‰å£½å¸ (ç†Ÿé£Ÿç³»)",
      note: "å£½å¸åº—ä¸»æ”»ç‚™ç‡’ã€å¤©å©¦ç¾…ã€çƒé¾éºµã€‚"
    },
    spots: [
      { name: "ä¼è¦‹ç¨»è·å¤§ç¤¾", type: "temple" },
      { name: "æ¸…æ°´å¯º", type: "temple" },
      { name: "äºŒå¹´å‚/ä¸‰å¹´å‚", type: "walk" }
    ]
  },
  {
    day: 7,
    date: "2026/04/24",
    weekday: "é€±äº”",
    title: "Kids Plaza & è¿”å°",
    intensity: "medium",
    intensityScore: 6,
    location: "Rinku Premium Outlets",
    displayLocation: "è‡¨ç©ºåŸ -> é—œè¥¿æ©Ÿå ´",
    desc: "ä¸Šåˆ Kids Plaza æ”¾é›»ï¼Œä¸‹åˆè‡¨ç©ºåŸ Outlet æœ€å¾Œæ¡è³¼ã€‚20:55 ç­æ©Ÿè¿”å°ã€‚",
    userNotes: "",
    meals: {
      breakfast: "é£¯åº—é€€æˆ¿",
      lunch: "æ‰‡ç”º/æ¢…ç”°ç°¡é¤",
      dinner: "æ©Ÿå ´/Outlet ç¾é£Ÿ",
      note: "é è¨ˆ 18:30 å‰æŠµé”æ©Ÿå ´å ±åˆ°ã€‚"
    },
    spots: [
      { name: "Kids Plaza Osaka", type: "play" },
      { name: "è‡¨ç©ºåŸ Outlet", type: "shopping" },
      { name: "é—œè¥¿åœ‹éš›æ©Ÿå ´ (KIX)", type: "transport" }
    ]
  }
];

const USJ_RIDES = [
  { id: 1, name: "ç‘ªåˆ©æ­è³½è»Šï¼šåº«å·´çš„æŒ‘æˆ°æ›¸", minHeight: 107, area: "ä»»å¤©å ‚", type: "åˆºæ¿€", switch: true },
  { id: 2, name: "è€€è¥¿å†’éšª", minHeight: 86, area: "ä»»å¤©å ‚", type: "æº«å’Œ", switch: false },
  { id: 3, name: "å“ˆåˆ©æ³¢ç‰¹ç¦å¿Œä¹‹æ—…", minHeight: 122, area: "å“ˆåˆ©æ³¢ç‰¹", type: "åˆºæ¿€", switch: true },
  { id: 4, name: "é·¹é¦¬çš„é£›è¡Œ", minHeight: 92, area: "å“ˆåˆ©æ³¢ç‰¹", type: "æº«å’Œ", switch: true },
  { id: 5, name: "å°å°å…µç˜‹ç‹‚ä¹˜è»ŠéŠ", minHeight: 102, area: "å°å°å…µ", type: "åˆºæ¿€", switch: true },
  { id: 6, name: "å°å°å…µå†°å‡é›·å°„å…‰", minHeight: 92, area: "å°å°å…µ", type: "æº«å’Œ", switch: false },
  { id: 7, name: "å¤§ç™½é¯Š", minHeight: 0, area: "è¦ªå–„æ‘", type: "é©šæ‚š", switch: true },
  { id: 8, name: "é£›å¤©ç¿¼é¾", minHeight: 132, area: "ä¾ç¾…ç´€", type: "è¶…åˆºæ¿€", switch: true },
];

// --- çµ„ä»¶ ---

const GoogleMapEmbed = ({ location }) => {
  const encodedLoc = encodeURIComponent(location);
  const mapSrc = `https://maps.google.com/maps?q=${encodedLoc}&t=&z=14&ie=UTF8&iwloc=&output=embed`;

  return (
    <div className="mt-4 rounded-lg overflow-hidden border border-gray-200 shadow-inner bg-gray-100 relative">
      <div className="absolute top-2 right-2 z-10">
        <a 
          href={`https://www.google.com/maps/search/?api=1&query=${encodedLoc}`} 
          target="_blank" 
          rel="noopener noreferrer"
          className="bg-white/90 hover:bg-white text-blue-600 text-xs font-bold px-3 py-1.5 rounded-full shadow-sm flex items-center gap-1 border border-gray-200 transition-colors"
        >
          <ExternalLink size={12} /> é–‹å•Ÿ Google Map
        </a>
      </div>
      <iframe
        title={`Map of ${location}`}
        width="100%"
        height="200"
        frameBorder="0"
        scrolling="no"
        marginHeight="0"
        marginWidth="0"
        src={mapSrc}
        className="w-full h-48 bg-gray-200"
      ></iframe>
    </div>
  );
};

const IntensityBadge = ({ score }) => {
  let color = "bg-green-100 text-green-800";
  let label = "è¼•é¬†";
  if (score >= 8) {
    color = "bg-red-100 text-red-800";
    label = "é«˜å¼·åº¦";
  } else if (score >= 5) {
    color = "bg-yellow-100 text-yellow-800";
    label = "ä¸­ç­‰";
  }

  return (
    <span className={`px-2 py-1 rounded-full text-xs font-bold ${color} flex items-center gap-1`}>
      <Activity size={12} /> {label} ({score})
    </span>
  );
};

const RideChecker = () => {
  const [height, setHeight] = useState(100);

  return (
    <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
      <div className="flex items-center gap-2 mb-4">
        <div className="p-2 bg-blue-100 rounded-lg text-blue-600">
          <Baby size={24} />
        </div>
        <div>
          <h3 className="text-lg font-bold text-gray-800">USJ è¨­æ–½èº«é«˜å¿«ç¯©</h3>
          <p className="text-sm text-gray-500">è¼¸å…¥å°æœ‹å‹èº«é«˜ï¼Œå³æ™‚åˆ¤æ–·å¯ç©è¨­æ–½</p>
        </div>
      </div>

      <div className="mb-6">
        <label className="block text-sm font-medium text-gray-700 mb-2">
          å°æœ‹å‹èº«é«˜: <span className="text-blue-600 font-bold text-xl">{height} cm</span>
        </label>
        <input
          type="range"
          min="80"
          max="140"
          value={height}
          onChange={(e) => setHeight(parseInt(e.target.value))}
          className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600"
        />
        <div className="flex justify-between text-xs text-gray-400 mt-1">
          <span>80cm</span>
          <span>100cm (äºŒå¯¶)</span>
          <span>115cm (å¤§å¯¶)</span>
          <span>140cm</span>
        </div>
      </div>

      <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
        {USJ_RIDES.map((ride) => {
          const isAllowed = height >= ride.minHeight;
          return (
            <div key={ride.id} className={`p-3 rounded-lg border flex items-center justify-between ${isAllowed ? 'border-green-200 bg-green-50' : 'border-red-200 bg-red-50'}`}>
              <div>
                <div className="font-bold text-gray-800 text-sm">{ride.name}</div>
                <div className="text-xs text-gray-500 mt-1">{ride.area} | {ride.type}</div>
                {!isAllowed && ride.switch && (
                   <span className="text-[10px] text-orange-600 font-bold mt-1 block">ğŸ’¡ å»ºè­°ä½¿ç”¨ Child Switch (è¼ªæµä¹˜å)</span>
                )}
              </div>
              <div className="flex-shrink-0 ml-2">
                {isAllowed ? (
                  <CheckCircle className="text-green-600" size={20} />
                ) : (
                  <div className="flex flex-col items-center">
                    <XCircle className="text-red-500" size={20} />
                    <span className="text-[10px] text-red-500 font-bold mt-1">{ride.minHeight}cm+</span>
                  </div>
                )}
              </div>
            </div>
          );
        })}
      </div>
    </div>
  );
};

const ExpenseTracker = () => {
  const [expenses, setExpenses] = useState([]);
  const [desc, setDesc] = useState("");
  const [amount, setAmount] = useState("");

  const handleAdd = () => {
    if (!desc || !amount) return;
    const newExpense = {
      id: Date.now(),
      desc,
      amount: parseInt(amount),
      time: new Date().toLocaleTimeString('zh-TW', {hour: '2-digit', minute:'2-digit'})
    };
    setExpenses([newExpense, ...expenses]);
    setDesc("");
    setAmount("");
  };

  const total = expenses.reduce((sum, item) => sum + item.amount, 0);

  return (
    <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
      <div className="flex items-center gap-2 mb-4">
        <div className="p-2 bg-yellow-100 rounded-lg text-yellow-600">
          <DollarSign size={24} />
        </div>
        <div>
          <h3 className="text-lg font-bold text-gray-800">ç°¡æ˜“è¨˜å¸³</h3>
          <p className="text-sm text-gray-500">è¨˜éŒ„æ—…è¡Œä¸­çš„èŠ±è²» (æ—¥å¹£)</p>
        </div>
      </div>

      <div className="bg-gray-50 p-4 rounded-lg mb-4 flex gap-2">
         <input 
           type="text" 
           placeholder="é …ç›® (å¦‚: è²·é£²æ–™)" 
           className="flex-1 p-2 border border-gray-300 rounded-md text-sm"
           value={desc}
           onChange={(e) => setDesc(e.target.value)}
         />
         <input 
           type="number" 
           placeholder="Â¥ é‡‘é¡" 
           className="w-24 p-2 border border-gray-300 rounded-md text-sm"
           value={amount}
           onChange={(e) => setAmount(e.target.value)}
         />
         <button 
           onClick={handleAdd}
           className="bg-blue-600 text-white p-2 rounded-md hover:bg-blue-700"
         >
           <Plus size={20} />
         </button>
      </div>

      <div className="mb-4">
        <div className="text-right text-sm text-gray-600">ç¸½æ”¯å‡º</div>
        <div className="text-right text-2xl font-bold text-gray-800">Â¥ {total.toLocaleString()}</div>
      </div>

      <div className="space-y-2 max-h-60 overflow-y-auto">
        {expenses.length === 0 && <p className="text-center text-gray-400 text-xs py-4">å°šæœªæœ‰è¨˜éŒ„</p>}
        {expenses.map((item) => (
          <div key={item.id} className="flex justify-between items-center p-2 border-b border-gray-100 last:border-0">
            <div className="flex flex-col">
              <span className="text-sm font-medium text-gray-700">{item.desc}</span>
              <span className="text-xs text-gray-400">{item.time}</span>
            </div>
            <div className="flex items-center gap-3">
              <span className="font-bold text-gray-800">Â¥ {item.amount.toLocaleString()}</span>
              <button 
                onClick={() => setExpenses(expenses.filter(e => e.id !== item.id))}
                className="text-red-300 hover:text-red-500"
              >
                <Trash2 size={14} />
              </button>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
};

// --- æ–°å¢ï¼šæ—¥èªå­¸ç¿’å¡ç‰‡çµ„ä»¶ (åŒ…å«æ¯æ—¥ä¸€å¥) ---
const LanguageLearning = () => {
  const [dailyPhrase, setDailyPhrase] = useState(DAILY_PHRASES[0]);

  const handleRandomPhrase = () => {
    const randomIndex = Math.floor(Math.random() * DAILY_PHRASES.length);
    setDailyPhrase(DAILY_PHRASES[randomIndex]);
  };

  useEffect(() => {
    handleRandomPhrase();
  }, []);

  return (
    <div className="space-y-6">
      
      {/* æ¯æ—¥ä¸€å¥å¡ç‰‡ */}
      <div className="bg-gradient-to-r from-pink-500 to-rose-500 p-4 rounded-xl shadow-md text-white relative overflow-hidden">
        <div className="flex justify-between items-start mb-2 relative z-10">
          <div className="flex items-center gap-2">
            <div className="p-1 bg-white/20 rounded-lg">
              <Star size={20} className="text-yellow-300 fill-current" />
            </div>
            <h3 className="text-lg font-bold">æ¯æ—¥ä¸€å¥æŒ‘æˆ° (å…±66å¥)</h3>
          </div>
          <button onClick={handleRandomPhrase} className="p-1 bg-white/10 rounded-full hover:bg-white/20 transition-colors">
            <RefreshCw size={16} />
          </button>
        </div>
        
        <div className="mt-4 text-center relative z-10">
          <div 
             className="text-3xl font-bold mb-2 cursor-pointer hover:scale-105 transition-transform flex items-center justify-center gap-2"
             onClick={() => speakJapanese(dailyPhrase.jp)}
          >
            {dailyPhrase.jp} <Volume2 size={24} className="opacity-80" />
          </div>
          <div className="text-sm font-medium text-pink-100 mb-2">{dailyPhrase.romaji}</div>
          <div className="text-xl font-bold mb-1">{dailyPhrase.ch}</div>
          <div className="text-xs text-pink-100 opacity-90">{dailyPhrase.desc}</div>
        </div>
      </div>

      <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-200">
        <div className="flex items-center gap-2 mb-2">
          <div className="p-2 bg-pink-100 rounded-lg text-pink-600">
            <BookOpen size={24} />
          </div>
          <h3 className="text-lg font-bold text-gray-800">åˆ†é¡å­¸ç¿’ (é»æ“Šç™¼éŸ³)</h3>
        </div>
        <p className="text-sm text-gray-500 mb-4">é»æ“Šå¡ç‰‡ç·´ç¿’èªªèªªçœ‹ï¼</p>
        
        <div className="space-y-6">
          {LEARNING_DATA.map((category) => (
            <div key={category.id} className="border-t border-gray-100 pt-4 first:border-0 first:pt-0">
              <h4 className={`text-md font-bold mb-3 px-2 py-1 rounded inline-block ${category.color}`}>
                {category.category}
              </h4>
              
              {/* å–®å­—å¡ç‰‡ */}
              <div className="grid grid-cols-2 gap-3 mb-4">
                {category.words.map((word, idx) => (
                  <div 
                    key={idx} 
                    className="bg-gray-50 p-3 rounded-lg border border-gray-100 hover:shadow-md transition-shadow text-center relative group cursor-pointer active:scale-95 transition-transform"
                    onClick={() => speakJapanese(word.jp)}
                  >
                     {/* Hover æç¤ºéŸ³æ•ˆ (è¦–è¦ºæ¨¡æ“¬) */}
                    <div className="absolute top-2 right-2 text-gray-300 group-hover:text-blue-500">
                      <Volume2 size={14} />
                    </div>
                    <div className="text-xl font-bold text-gray-800 mb-1">{word.jp}</div>
                    <div className="text-xs text-blue-600 font-medium mb-1">{word.romaji}</div>
                    <div className="text-sm text-gray-500">{word.ch} <span className="text-xs text-gray-400">({word.en})</span></div>
                  </div>
                ))}
              </div>

              {/* å¯¦ç”¨ä¾‹å¥ */}
              <div 
                className="bg-blue-50 p-3 rounded-lg border border-blue-100 flex items-start gap-3 cursor-pointer hover:bg-blue-100 transition-colors"
                onClick={() => speakJapanese(category.phrase.jp)}
              >
                <div className="p-2 bg-blue-100 rounded-full text-blue-600 mt-1">
                  <PlayCircle size={20} />
                </div>
                <div>
                  <div className="text-xs font-bold text-blue-500 mb-1">æŒ‘æˆ°èªªä¸€å¥ï¼š</div>
                  <div className="text-lg font-bold text-gray-800">{category.phrase.jp}</div>
                  <div className="text-sm text-blue-700">{category.phrase.romaji}</div>
                  <div className="text-sm text-gray-500 mt-1">{category.phrase.ch}</div>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  );
};

const DayCard = ({ dayData, isExpanded, onToggle, onSaveNote }) => {
  const [noteText, setNoteText] = useState(dayData.userNotes || "");
  const [isEditingNote, setIsEditingNote] = useState(false);

  const handleSave = () => {
    onSaveNote(dayData.day, noteText);
    setIsEditingNote(false);
  };

  return (
    <div className={`bg-white rounded-xl shadow-sm border border-gray-200 transition-all duration-300 ${isExpanded ? 'ring-2 ring-blue-500' : 'hover:shadow-md'}`}>
      {/* Header */}
      <div 
        className="p-4 flex items-center justify-between cursor-pointer"
        onClick={onToggle}
      >
        <div className="flex items-center gap-4">
          <div className="flex flex-col items-center justify-center w-12 h-12 bg-gray-100 rounded-lg text-gray-600 font-bold">
            <span className="text-xs uppercase">Day</span>
            <span className="text-xl">{dayData.day}</span>
          </div>
          <div>
            <div className="text-xs text-gray-500 flex gap-2">
              <span>{dayData.date}</span>
              <span>{dayData.weekday}</span>
            </div>
            <h3 className="text-lg font-bold text-gray-800">{dayData.title}</h3>
          </div>
        </div>
        <IntensityBadge score={dayData.intensityScore} />
      </div>

      {/* Expanded Details */}
      {isExpanded && (
        <div className="p-4 pt-0 border-t border-gray-100 mt-2">
          
          {/* User Note Section */}
          <div className="mb-4 bg-yellow-50 p-3 rounded-lg border border-yellow-100">
            <div className="flex justify-between items-center mb-2">
              <h4 className="text-xs font-bold text-yellow-700 uppercase flex items-center gap-1">
                <Edit3 size={12} /> æˆ‘çš„ç­†è¨˜
              </h4>
              {!isEditingNote ? (
                <button onClick={() => setIsEditingNote(true)} className="text-xs text-blue-600 hover:underline">ç·¨è¼¯</button>
              ) : (
                <button onClick={handleSave} className="text-xs text-green-600 font-bold flex items-center gap-1">
                  <Save size={12} /> å„²å­˜
                </button>
              )}
            </div>
            
            {isEditingNote ? (
              <textarea 
                className="w-full text-sm p-2 border border-yellow-300 rounded bg-white text-gray-700"
                rows="3"
                value={noteText}
                onChange={(e) => setNoteText(e.target.value)}
                placeholder="å¯«é»ä»€éº¼... (ä¾‹å¦‚: 14:00 é›†åˆ, è¨˜å¾—è²·ç‰›å¥¶)"
              />
            ) : (
              <p className="text-sm text-gray-600 whitespace-pre-wrap">
                {dayData.userNotes ? dayData.userNotes : <span className="text-gray-400 italic">é»æ“Šç·¨è¼¯ä¾†æ–°å¢ç­†è¨˜...</span>}
              </p>
            )}
          </div>

          {/* Location & Desc */}
          <div className="py-2">
            <p className="text-gray-600 text-sm leading-relaxed mb-2">{dayData.desc}</p>
            <div className="flex items-center gap-1 text-xs text-gray-500">
              <MapPin size={14} />
              <span>ä¸»è¦å€åŸŸ: {dayData.displayLocation}</span>
            </div>
          </div>

          {/* Spots */}
          <div className="mb-4">
            <h4 className="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2">ä»Šæ—¥æ™¯é»</h4>
            <div className="flex flex-wrap gap-2">
              {dayData.spots.map((spot, idx) => (
                <span key={idx} className="px-2 py-1 bg-blue-50 text-blue-700 text-xs rounded-md border border-blue-100 flex items-center gap-1">
                  {spot.type === 'transport' && <Train size={12} />}
                  {spot.type === 'play' && <Star size={12} />}
                  {spot.name}
                </span>
              ))}
            </div>
          </div>

          {/* Food Strategy */}
          <div className="bg-orange-50 p-3 rounded-lg border border-orange-100 mb-2">
             <h4 className="text-xs font-bold text-orange-800 uppercase tracking-wider mb-2 flex items-center gap-1">
               <Utensils size={12} /> é¤é£Ÿç­–ç•¥
             </h4>
             <div className="grid grid-cols-1 gap-2 text-sm text-gray-700">
               <div className="flex gap-2"><span className="text-orange-400 font-bold min-w-[30px]">æ—©:</span> {dayData.meals.breakfast}</div>
               <div className="flex gap-2"><span className="text-orange-400 font-bold min-w-[30px]">åˆ:</span> {dayData.meals.lunch}</div>
               <div className="flex gap-2"><span className="text-orange-400 font-bold min-w-[30px]">æ™š:</span> {dayData.meals.dinner}</div>
             </div>
             {dayData.meals.note && (
               <div className="mt-2 pt-2 border-t border-orange-200 text-xs text-orange-700 flex gap-1">
                 <Info size={12} className="mt-0.5" /> {dayData.meals.note}
               </div>
             )}
          </div>

          {/* Google Map Section */}
          <GoogleMapEmbed location={dayData.location} />
          
        </div>
      )}
    </div>
  );
};

export default function App() {
  const [activeTab, setActiveTab] = useState('itinerary');
  const [itineraryData, setItineraryData] = useState(INITIAL_ITINERARY_DATA);
  const [expandedDay, setExpandedDay] = useState(3); // Default open USJ day

  // Update user notes
  const handleUpdateNote = (dayId, newNote) => {
    setItineraryData(prevData => 
      prevData.map(day => 
        day.day === dayId ? { ...day, userNotes: newNote } : day
      )
    );
  };

  return (
    <div className="min-h-screen bg-gray-50 font-sans text-gray-900 pb-20 relative">
      {/* App Header */}
      <header className="bg-blue-600 text-white p-4 shadow-lg sticky top-0 z-10">
        <div className="max-w-md mx-auto flex justify-between items-center">
          <div>
            <h1 className="text-xl font-bold">å¤§é˜ªè¦ªå­ 7 æ—¥éŠ</h1>
            <p className="text-xs text-blue-200">2026/04/18 - 04/24 â€¢ 2å¤§2å°</p>
          </div>
          <div className="bg-blue-700 p-2 rounded-full">
            <Plane size={20} />
          </div>
        </div>
      </header>

      {/* Main Content */}
      <main className="max-w-md mx-auto p-4">
        
        {activeTab === 'itinerary' && (
          <div className="space-y-4 animate-fadeIn">
            <div className="flex justify-between items-end mb-2 px-1">
              <h2 className="text-lg font-bold text-gray-800">è¡Œç¨‹è¡¨</h2>
              <span className="text-xs text-gray-500">é»æ“Šå¡ç‰‡æŸ¥çœ‹åœ°åœ–èˆ‡è©³æƒ…</span>
            </div>

            {itineraryData.map((day) => (
              <DayCard 
                key={day.day} 
                dayData={day} 
                isExpanded={expandedDay === day.day}
                onToggle={() => setExpandedDay(expandedDay === day.day ? null : day.day)}
                onSaveNote={handleUpdateNote}
              />
            ))}
          </div>
        )}

        {activeTab === 'tools' && (
          <div className="space-y-6 animate-fadeIn">
             <h2 className="text-lg font-bold text-gray-800 px-1">å¯¦ç”¨å·¥å…·</h2>
             {/* Tool 1: USJ Height Check */}
             <RideChecker />
             
             {/* Tool 2: Expense Tracker (New) */}
             <ExpenseTracker />
          </div>
        )}

        {/* æ–°å¢ï¼šæ—¥èªå­¸ç¿’ Tab å…§å®¹ */}
        {activeTab === 'learning' && (
          <div className="space-y-6 animate-fadeIn">
             <h2 className="text-lg font-bold text-gray-800 px-1">æ—…éŠæ—¥èª</h2>
             <LanguageLearning />
          </div>
        )}

        {activeTab === 'packing' && (
           <div className="space-y-6 animate-fadeIn">
             <h2 className="text-lg font-bold text-gray-800 px-1">è¡Œå‰æ¸…å–®</h2>
             <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                <div className="flex items-center gap-2 mb-4">
                  <div className="p-2 bg-orange-100 rounded-lg text-orange-600">
                    <CheckCircle size={24} />
                  </div>
                  <h3 className="text-lg font-bold text-gray-800">é‡è¦å‚™å¿˜éŒ„</h3>
                </div>
                <ul className="space-y-3">
                  <li className="flex items-center gap-3 text-sm text-gray-700">
                    <input type="checkbox" className="w-5 h-5 text-blue-600 rounded focus:ring-blue-500" defaultChecked />
                    <span>ä¸‹è¼‰ USJ å®˜æ–¹ APP (ç™»éŒ„é–€ç¥¨)</span>
                  </li>
                  <li className="flex items-center gap-3 text-sm text-gray-700">
                    <input type="checkbox" className="w-5 h-5 text-blue-600 rounded focus:ring-blue-500" defaultChecked />
                    <span>æº–å‚™ 100 åœ“ç¡¬å¹£ (æ‰­è›‹/ç½®ç‰©æ«ƒ)</span>
                  </li>
                  <li className="flex items-center gap-3 text-sm text-gray-700">
                    <input type="checkbox" className="w-5 h-5 text-blue-600 rounded focus:ring-blue-500" />
                    <span>ç¢ºèªæ¼«éŠç¶²å¡/WiFi æ©Ÿ</span>
                  </li>
                   <li className="flex items-center gap-3 text-sm text-gray-700">
                    <input type="checkbox" className="w-5 h-5 text-blue-600 rounded focus:ring-blue-500" />
                    <span>æº–å‚™å…’ç«¥è¼•ä¾¿é›¨è¡£ (USJ æ¿•èº«ç”¨)</span>
                  </li>
                </ul>
             </div>
           </div>
        )}
      </main>

      {/* Bottom Navigation Bar */}
      <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg z-20 pb-safe">
        <div className="max-w-md mx-auto flex justify-around items-center h-16">
          <button 
            onClick={() => setActiveTab('itinerary')}
            className={`flex flex-col items-center justify-center w-full h-full space-y-1 ${activeTab === 'itinerary' ? 'text-blue-600' : 'text-gray-400'}`}
          >
            <Home size={24} strokeWidth={activeTab === 'itinerary' ? 2.5 : 2} />
            <span className="text-[10px] font-medium">è¡Œç¨‹</span>
          </button>
          
          <button 
            onClick={() => setActiveTab('tools')}
            className={`flex flex-col items-center justify-center w-full h-full space-y-1 ${activeTab === 'tools' ? 'text-blue-600' : 'text-gray-400'}`}
          >
            <Settings size={24} strokeWidth={activeTab === 'tools' ? 2.5 : 2} />
            <span className="text-[10px] font-medium">å·¥å…·</span>
          </button>

          {/* æ–°å¢ï¼šæ—¥èªæŒ‰éˆ• */}
          <button 
            onClick={() => setActiveTab('learning')}
            className={`flex flex-col items-center justify-center w-full h-full space-y-1 ${activeTab === 'learning' ? 'text-blue-600' : 'text-gray-400'}`}
          >
            <BookOpen size={24} strokeWidth={activeTab === 'learning' ? 2.5 : 2} />
            <span className="text-[10px] font-medium">æ—¥èª</span>
          </button>

          <button 
            onClick={() => setActiveTab('packing')}
            className={`flex flex-col items-center justify-center w-full h-full space-y-1 ${activeTab === 'packing' ? 'text-blue-600' : 'text-gray-400'}`}
          >
            <List size={24} strokeWidth={activeTab === 'packing' ? 2.5 : 2} />
            <span className="text-[10px] font-medium">æ¸…å–®</span>
          </button>
        </div>
      </div>
    </div>
  );
}
