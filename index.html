<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¤§é˜ªè¦ªå­7æ—¥éŠ</title>
    
    <!-- iOS Web App è¨­å®š (è®“ç¶²é è®Šèº« APP çš„é—œéµ) -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="å¤§é˜ªæ—…éŠ">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/7893/7893979.png"> <!-- ç¯„ä¾‹é£›æ©Ÿåœ–ç¤º -->

    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* é‡å° iOS çš„å„ªåŒ– */
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #f9fafb; 
            padding-bottom: 90px; /* å¢åŠ åº•éƒ¨ç©ºé–“çµ¦ iPhone çš„ Home Bar */
            -webkit-tap-highlight-color: transparent; /* ç§»é™¤é»æ“Šé«˜äº® */
        }
        .tab-active { color: #2563eb; }
        .tab-inactive { color: #9ca3af; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        /* éš±è—æ²è»¸ä½†ä¿æŒæ»¾å‹• */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* é‡å° iPhone å®‰å…¨å€åŸŸçš„èª¿æ•´ */
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>
<body>

    <!-- é ‚éƒ¨æ¨™é¡Œ -->
    <header class="bg-blue-600 text-white p-4 shadow-lg sticky top-0 z-50 pt-safe">
        <div class="max-w-md mx-auto flex justify-between items-center pt-2"> <!-- å¢åŠ  pt-2 é¿é–‹ç‹€æ…‹åˆ— -->
            <div>
                <h1 class="text-xl font-bold">å¤§é˜ªè¦ªå­ 7 æ—¥éŠ</h1>
                <p class="text-xs text-blue-200">2026/04/18 - 04/24 â€¢ 2å¤§2å°</p>
            </div>
            <div class="bg-blue-700 p-2 rounded-full">
                <i data-lucide="plane" class="w-5 h-5"></i>
            </div>
        </div>
    </header>

    <!-- ä¸»è¦å…§å®¹å€ -->
    <main id="app-content" class="max-w-md mx-auto p-4 min-h-screen">
        <!-- å…§å®¹ç”± JavaScript å‹•æ…‹æ¸²æŸ“ -->
    </main>

    <!-- åº•éƒ¨å°èˆªåˆ— -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] z-50 pb-safe">
        <div class="max-w-md mx-auto flex justify-around items-center h-16 pb-1"> <!-- å¢åŠ  pb-1 å¾®èª¿ä½ç½® -->
            <button onclick="switchTab('itinerary')" class="nav-btn flex flex-col items-center justify-center w-full h-full space-y-1 text-gray-400" id="btn-itinerary">
                <i data-lucide="home" class="w-6 h-6"></i>
                <span class="text-[10px] font-medium">è¡Œç¨‹</span>
            </button>
            <button onclick="switchTab('tools')" class="nav-btn flex flex-col items-center justify-center w-full h-full space-y-1 text-gray-400" id="btn-tools">
                <i data-lucide="settings" class="w-6 h-6"></i>
                <span class="text-[10px] font-medium">å·¥å…·</span>
            </button>
            <button onclick="switchTab('learning')" class="nav-btn flex flex-col items-center justify-center w-full h-full space-y-1 text-gray-400" id="btn-learning">
                <i data-lucide="book-open" class="w-6 h-6"></i>
                <span class="text-[10px] font-medium">æ—¥èª</span>
            </button>
            <button onclick="switchTab('packing')" class="nav-btn flex flex-col items-center justify-center w-full h-full space-y-1 text-gray-400" id="btn-packing">
                <i data-lucide="list" class="w-6 h-6"></i>
                <span class="text-[10px] font-medium">æ¸…å–®</span>
            </button>
        </div>
    </nav>

    <script>
        // --- è³‡æ–™åº« ---
        const ITINERARY_DATA = [
            {
                day: 1, date: "4/18 (å…­)", title: "æŠµé”ç¥æˆ¶èˆ‡ç§»å‹•è‡³å¤§é˜ª", intensity: 5, location: "Kobe Airport", displayLoc: "ç¥æˆ¶æ©Ÿå ´ -> å¤§é˜ªå¸‚å€",
                desc: "10:30 æŠµé”ç¥æˆ¶æ©Ÿå ´ (UKB)ã€‚æ­ä¹˜ Port Liner è‡³ä¸‰å®®ç«™ï¼Œè½‰è»Šå‰å¾€å¤§é˜ª(é›£æ³¢/æ¢…ç”°)ã€‚Check-in å¾Œæ¡è²·é›¶é£Ÿã€‚",
                meals: { b: "æ©Ÿä¸Š", l: "ç¥æˆ¶ä¸‰å®®/å¤§é˜ªå¸‚å€", d: "é³¥è²´æ— (å…¨ç†Ÿé£Ÿ)" },
                spots: ["ç¥æˆ¶æ©Ÿå ´ (UKB)", "ç§»å‹•è‡³å¤§é˜ª", "ä¾¿åˆ©å•†åº—"]
            },
            {
                day: 2, date: "4/19 (æ—¥)", title: "å¥ˆè‰¯ï¼šå°é¹¿èˆ‡å¤§ä½›", intensity: 7, location: "Nara Park", displayLoc: "å¥ˆè‰¯å…¬åœ’",
                desc: "æˆ¶å¤–èµ°å‹•ç‚ºä¸»ã€‚é¿é–‹å…‡çŒ›å¤§é¹¿ï¼Œå‰å¾€æ±å¤§å¯ºèˆ‡å°é¹¿äº’å‹•ã€‚",
                meals: { b: "ä¾¿åˆ©å•†åº—", l: "å¿—æ´¥é¦™é‡œé£¯", d: "å¸‚å€ç°¡é¤" },
                spots: ["è¿‘éµå¥ˆè‰¯ç«™", "å¥ˆè‰¯å…¬åœ’", "æ±å¤§å¯º"]
            },
            {
                day: 3, date: "4/20 (ä¸€)", title: "ğŸ”¥ ç’°çƒå½±åŸ USJ", intensity: 10, location: "Universal Studios Japan", displayLoc: "USJ ç’°çƒå½±åŸ",
                desc: "å…¨æ—¥æˆ°é¬¥è¡Œç¨‹ã€‚è¶…ç´šä»»å¤©å ‚ä¸–ç•Œä¸»å ´ï¼Œæ—©å‡ºæ™šæ­¸ã€‚",
                meals: { b: "é£¯ç³°", l: "åœ’å€è¼•é£Ÿ", d: "ä¾¿åˆ©å•†åº—ç‚¸é›" },
                spots: ["ä»»å¤©å ‚ä¸–ç•Œ", "å°å°å…µæ¨‚åœ’", "ç’°çƒå¥‡å¢ƒ"]
            },
            {
                day: 4, date: "4/21 (äºŒ)", title: "äº¬éƒ½éµé“åšç‰©é¤¨ (ç·©è¡)", intensity: 3, location: "Kyoto Railway Museum", displayLoc: "äº¬éƒ½æ¢…å°è·¯",
                desc: "é«”åŠ›æ¢å¾©æ—¥ã€‚å®¤å…§ç‚ºä¸»ï¼Œå¤šåº§ä½ã€‚",
                meals: { b: "é£¯åº—", l: "ç«è»Šä¾¿ç•¶", d: "æ‹‰éºµå°è·¯ (ä¸è¾£)" },
                spots: ["äº¬éƒ½éµé“åšç‰©é¤¨", "äº¬éƒ½è»Šç«™"]
            },
            {
                day: 5, date: "4/22 (ä¸‰)", title: "æµ·éŠé¤¨ + æ¨‚é«˜æ¨‚åœ’", intensity: 8, location: "Osaka Aquarium Kaiyukan", displayLoc: "å¤§é˜ªæ¸¯æµ·éŠé¤¨",
                desc: "æ¸¯ç£å€å…¨æ—¥éŠã€‚æ¨‚é«˜æ¨‚åœ’å°å­©æœ€æ„›ã€‚",
                meals: { b: "ä¾¿åˆ©å•†åº—", l: "å¤©ä¿å±±å¤§é˜ªç‡’", d: "ä¾¿åˆ©å•†åº—" },
                spots: ["æµ·éŠé¤¨", "å¤§é˜ªæ¨‚é«˜æ¨‚åœ’", "æ‘©å¤©è¼ª"]
            },
            {
                day: 6, date: "4/23 (å››)", title: "äº¬éƒ½ç¶“å…¸æ•£ç­–", intensity: 6, location: "Kiyomizu-dera", displayLoc: "äº¬éƒ½æ¸…æ°´å¯º",
                desc: "æ„Ÿå—å‚³çµ±æ—¥æœ¬ã€‚ä¼è¦‹ç¨»è·åªèµ°å‰æ®µï¼Œæ¸…æ°´å¯ºæ…¢æ…¢é€›ã€‚",
                meals: { b: "é£¯åº—", l: "æ¹¯è±†è…/è¦ªå­ä¸¼", d: "è¿´è½‰å£½å¸ (ç†Ÿé£Ÿ)" },
                spots: ["ä¼è¦‹ç¨»è·", "æ¸…æ°´å¯º", "äºŒå¹´å‚"]
            },
            {
                day: 7, date: "4/24 (äº”)", title: "Kids Plaza & è¿”å°", intensity: 6, location: "Rinku Premium Outlets", displayLoc: "è‡¨ç©ºåŸ -> æ©Ÿå ´",
                desc: "ä¸Šåˆ Kids Plaza æ”¾é›»ï¼Œä¸‹åˆè‡¨ç©ºåŸ Outlet æœ€å¾Œæ¡è³¼ã€‚20:55 ç­æ©Ÿè¿”å°ã€‚",
                meals: { b: "é€€æˆ¿", l: "æ‰‡ç”ºç°¡é¤", d: "æ©Ÿå ´/Outlet" },
                spots: ["Kids Plaza", "è‡¨ç©ºåŸ Outlet", "é—œè¥¿æ©Ÿå ´"]
            }
        ];

        const DAILY_PHRASES = [
            { ch: "è«‹çµ¦æˆ‘é€™å€‹ï¼", jp: "ã“ã‚Œãã ã•ã„ï¼", romaji: "Kore kudasai!" },
            { ch: "è¬è¬ï¼", jp: "ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼", romaji: "A-ri-ga-tou go-zai-ma-su!" },
            { ch: "å»æ‰€åœ¨å“ªè£¡ï¼Ÿ", jp: "ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹ï¼Ÿ", romaji: "Toire wa doko desu ka?" },
            { ch: "å¥½å¥½åƒï¼", jp: "ãŠã„ã—ã„ã§ã™ï¼", romaji: "Oishii desu!" },
            { ch: "å¤ªå¯æ„›äº†ï¼", jp: "ã‹ã‚ã„ã„ã§ã™ï¼", romaji: "Kawaii desu!" },
            { ch: "ä¸å¥½æ„æ€...", jp: "ã™ã¿ã¾ã›ã‚“...", romaji: "Sumimasen..." }
        ];

        const LEARNING_DATA = [
            {
                id: 'basic', cat: "åŸºæœ¬ç¦®è²Œ", color: "bg-green-100 text-green-700",
                words: [{jp:"ã“ã‚“ã«ã¡ã¯", ch:"ä½ å¥½"}, {jp:"ã‚ã‚ŠãŒã¨ã†", ch:"è¬è¬"}, {jp:"ã”ã‚ã‚“ãªã•ã„", ch:"å°ä¸èµ·"}, {jp:"ãƒˆã‚¤ãƒ¬", ch:"å»æ‰€"}],
                phrase: {jp:"ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹ï¼Ÿ", ch:"è«‹å•å»æ‰€åœ¨å“ªè£¡ï¼Ÿ", r:"Toire wa doko desu ka?"}
            },
            {
                id: 'hotel', cat: "é£¯åº—ä½å®¿", color: "bg-indigo-100 text-indigo-700",
                words: [{jp:"ã¸ã‚„", ch:"æˆ¿é–“"}, {jp:"ã‹ã", ch:"é‘°åŒ™"}, {jp:"ã‚¿ã‚ªãƒ«", ch:"æ¯›å·¾"}, {jp:"Wi-Fi", ch:"Wi-Fi"}],
                phrase: {jp:"ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ãŠã­ãŒã„ã—ã¾ã™", ch:"æˆ‘è¦è¾¦ç†å…¥ä½", r:"Check-in onegai shimasu"}
            },
            {
                id: 'shopping', cat: "é€›è¡—è³¼ç‰©", color: "bg-purple-100 text-purple-700",
                words: [{jp:"ã„ãã‚‰", ch:"å¤šå°‘éŒ¢"}, {jp:"ãµãã‚", ch:"è¢‹å­"}, {jp:"ã»ã—ã„", ch:"æƒ³è¦"}, {jp:"ã‚ã‚“ãœã„", ch:"å…ç¨…"}],
                phrase: {jp:"ãµãã‚ã‚’ãã ã•ã„", ch:"è«‹çµ¦æˆ‘è¢‹å­", r:"Fukuro o kudasai"}
            },
            {
                id: 'transport', cat: "äº¤é€šæ¢éšª", color: "bg-blue-100 text-blue-700",
                words: [{jp:"ã§ã‚“ã—ã‚ƒ", ch:"é›»è»Š"}, {jp:"ãˆã", ch:"è»Šç«™"}, {jp:"ãã£ã·", ch:"ç¥¨"}, {jp:"ã‚¿ã‚¯ã‚·ãƒ¼", ch:"è¨ˆç¨‹è»Š"}],
                phrase: {jp:"ã“ã‚Œã¯ãŠãŠã•ã‹ã«è¡Œãã¾ã™ã‹ï¼Ÿ", ch:"é€™å€‹å»å¤§é˜ªå—ï¼Ÿ", r:"Kore wa Osaka ni ikimasu ka?"}
            },
            {
                id: 'emergency', cat: "ç·Šæ€¥æ±‚åŠ©", color: "bg-gray-100 text-gray-700",
                words: [{jp:"ãŸã™ã‘ã¦", ch:"å¹«å¿™"}, {jp:"ã¾ã„ã”", ch:"è¿·è·¯"}, {jp:"ã„ãŸã„", ch:"ç—›"}, {jp:"ã³ã‚‡ã†ã„ã‚“", ch:"é†«é™¢"}],
                phrase: {jp:"ã¾ã„ã”ã«ãªã‚Šã¾ã—ãŸ", ch:"æˆ‘è¿·è·¯äº†", r:"Maigo ni narimashita"}
            }
        ];

        const USJ_RIDES = [
            { name: "ç‘ªåˆ©æ­è³½è»Š", h: 107, area: "ä»»å¤©å ‚", type: "åˆºæ¿€", switch: true },
            { name: "è€€è¥¿å†’éšª", h: 86, area: "ä»»å¤©å ‚", type: "æº«å’Œ", switch: false },
            { name: "å“ˆåˆ©æ³¢ç‰¹ç¦å¿Œä¹‹æ—…", h: 122, area: "å“ˆåˆ©æ³¢ç‰¹", type: "åˆºæ¿€", switch: true },
            { name: "é·¹é¦¬çš„é£›è¡Œ", h: 92, area: "å“ˆåˆ©æ³¢ç‰¹", type: "æº«å’Œ", switch: true },
            { name: "å°å°å…µç˜‹ç‹‚ä¹˜è»ŠéŠ", h: 102, area: "å°å°å…µ", type: "åˆºæ¿€", switch: true },
            { name: "å°å°å…µå†°å‡é›·å°„å…‰", h: 92, area: "å°å°å…µ", type: "æº«å’Œ", switch: false }
        ];

        // --- ç‹€æ…‹è®Šæ•¸ ---
        let currentTab = 'itinerary';
        let expandedDay = 3; // é è¨­æ‰“é–‹ Day 3
        let childHeight = 100;
        let expenses = JSON.parse(localStorage.getItem('osaka_expenses')) || [];

        // --- åˆå§‹åŒ– ---
        document.addEventListener('DOMContentLoaded', () => {
            render();
            lucide.createIcons();
        });

        // --- æ ¸å¿ƒæ¸²æŸ“å‡½æ•¸ ---
        function render() {
            const content = document.getElementById('app-content');
            
            // æ›´æ–°æŒ‰éˆ•æ¨£å¼
            document.querySelectorAll('.nav-btn').forEach(btn => {
                const isActive = btn.id === `btn-${currentTab}`;
                btn.className = `nav-btn flex flex-col items-center justify-center w-full h-full space-y-1 transition-colors ${isActive ? 'text-blue-600' : 'text-gray-400'}`;
            });

            // æ¸²æŸ“å…§å®¹
            if (currentTab === 'itinerary') renderItinerary(content);
            else if (currentTab === 'tools') renderTools(content);
            else if (currentTab === 'learning') renderLearning(content);
            else if (currentTab === 'packing') renderPacking(content);

            lucide.createIcons();
        }

        function switchTab(tab) {
            currentTab = tab;
            render();
        }

        // --- è¡Œç¨‹è¡¨æ¸²æŸ“ ---
        function renderItinerary(container) {
            let html = `
                <div class="bg-gradient-to-r from-purple-500 to-indigo-600 rounded-xl p-4 text-white shadow-md mb-6 fade-in">
                    <h2 class="font-bold text-lg mb-2">è¡Œç¨‹é‡é»</h2>
                    <ul class="text-sm space-y-1 text-purple-100">
                        <li class="flex items-center gap-2"><i data-lucide="check-circle" class="w-4 h-4"></i> USJ èˆ‡æµ·éŠé¤¨éŒ¯é–‹å®‰æ’</li>
                        <li class="flex items-center gap-2"><i data-lucide="check-circle" class="w-4 h-4"></i> å…©æ—¥å…¨æ—¥æ´»å‹•æ™šé¤ä¾¿åˆ©å•†åº—</li>
                        <li class="flex items-center gap-2"><i data-lucide="check-circle" class="w-4 h-4"></i> æ’é™¤ç”Ÿé£Ÿ/è¾£å‘³</li>
                    </ul>
                </div>
                <div class="space-y-4 fade-in">
            `;

            ITINERARY_DATA.forEach(day => {
                const isExpanded = expandedDay === day.day;
                const intensityColor = day.intensity >= 8 ? "bg-red-100 text-red-800" : (day.intensity >= 5 ? "bg-yellow-100 text-yellow-800" : "bg-green-100 text-green-800");
                const intensityLabel = day.intensity >= 8 ? "é«˜å¼·åº¦" : (day.intensity >= 5 ? "ä¸­ç­‰" : "è¼•é¬†");
                
                html += `
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden transition-all duration-300 ${isExpanded ? 'ring-2 ring-blue-500' : ''}">
                        <div class="p-4 flex items-center justify-between cursor-pointer" onclick="toggleDay(${day.day})">
                            <div class="flex items-center gap-4">
                                <div class="flex flex-col items-center justify-center w-12 h-12 bg-gray-100 rounded-lg text-gray-600 font-bold">
                                    <span class="text-xs uppercase">Day</span>
                                    <span class="text-xl">${day.day}</span>
                                </div>
                                <div>
                                    <div class="text-xs text-gray-500">${day.date}</div>
                                    <h3 class="text-lg font-bold text-gray-800">${day.title}</h3>
                                </div>
                            </div>
                            <span class="px-2 py-1 rounded-full text-xs font-bold ${intensityColor}">${intensityLabel}</span>
                        </div>
                        
                        ${isExpanded ? `
                        <div class="p-4 pt-0 border-t border-gray-100 mt-2 bg-gray-50/50">
                            <div class="py-3">
                                <p class="text-gray-600 text-sm leading-relaxed mb-2">${day.desc}</p>
                                <div class="flex items-center gap-1 text-xs text-gray-500">
                                    <i data-lucide="map-pin" class="w-3 h-3"></i> å€åŸŸ: ${day.displayLoc}
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <div class="flex flex-wrap gap-2">
                                    ${day.spots.map(s => `<span class="px-2 py-1 bg-blue-50 text-blue-700 text-xs rounded-md border border-blue-100">${s}</span>`).join('')}
                                </div>
                            </div>

                            <div class="bg-orange-50 p-3 rounded-lg border border-orange-100 mb-3">
                                <h4 class="text-xs font-bold text-orange-800 mb-2 flex items-center gap-1"><i data-lucide="utensils" class="w-3 h-3"></i> é¤é£Ÿ</h4>
                                <div class="grid grid-cols-1 gap-1 text-sm text-gray-700">
                                    <div><span class="text-orange-400 font-bold">æ—©:</span> ${day.meals.b}</div>
                                    <div><span class="text-orange-400 font-bold">åˆ:</span> ${day.meals.l}</div>
                                    <div><span class="text-orange-400 font-bold">æ™š:</span> ${day.meals.d}</div>
                                </div>
                            </div>

                            <div class="rounded-lg overflow-hidden border border-gray-200 shadow-inner relative h-48 bg-gray-200">
                                <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(day.location)}" target="_blank" class="absolute top-2 right-2 bg-white/90 px-3 py-1 rounded-full text-xs font-bold text-blue-600 shadow-sm z-10 flex items-center gap-1">
                                    <i data-lucide="external-link" class="w-3 h-3"></i> é–‹å•Ÿåœ°åœ–
                                </a>
                                <iframe width="100%" height="100%" frameborder="0" style="border:0" src="https://maps.google.com/maps?q=${encodeURIComponent(day.location)}&t=&z=14&ie=UTF8&iwloc=&output=embed"></iframe>
                            </div>
                        </div>` : ''}
                    </div>
                `;
            });
            
            html += `</div>`;
            container.innerHTML = html;
        }

        function toggleDay(day) {
            expandedDay = expandedDay === day ? null : day;
            render();
        }

        // --- å·¥å…·é æ¸²æŸ“ ---
        function renderTools(container) {
            let rideHtml = '';
            USJ_RIDES.forEach(ride => {
                const ok = childHeight >= ride.h;
                rideHtml += `
                    <div class="p-3 rounded-lg border flex items-center justify-between ${ok ? 'border-green-200 bg-green-50' : 'border-red-200 bg-red-50'} mb-2">
                        <div>
                            <div class="font-bold text-gray-800 text-sm">${ride.name}</div>
                            <div class="text-xs text-gray-500">${ride.area} | ${ride.type}</div>
                            ${!ok && ride.switch ? '<span class="text-[10px] text-orange-600 font-bold block">ğŸ’¡ å¯ç”¨ Child Switch</span>' : ''}
                        </div>
                        <div class="ml-2">
                            ${ok ? '<i data-lucide="check-circle" class="text-green-600 w-5 h-5"></i>' : `<div class="text-center"><i data-lucide="x-circle" class="text-red-500 w-5 h-5 mx-auto"></i><span class="text-[10px] text-red-500 font-bold">${ride.h}cm+</span></div>`}
                        </div>
                    </div>
                `;
            });

            // è¨˜å¸³åˆ—è¡¨
            const total = expenses.reduce((sum, item) => sum + item.amount, 0);
            const expenseList = expenses.length === 0 ? '<p class="text-center text-gray-400 text-xs py-4">å°šæœªæœ‰è¨˜éŒ„</p>' : expenses.map(item => `
                <div class="flex justify-between items-center p-2 border-b border-gray-100 last:border-0">
                    <div class="flex flex-col">
                        <span class="text-sm font-medium text-gray-700">${item.desc}</span>
                        <span class="text-xs text-gray-400">${item.time}</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <span class="font-bold text-gray-800">Â¥ ${item.amount.toLocaleString()}</span>
                        <button onclick="deleteExpense(${item.id})" class="text-red-300 hover:text-red-500"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                    </div>
                </div>
            `).join('');

            container.innerHTML = `
                <div class="space-y-6 fade-in">
                    <!-- USJ èº«é«˜æª¢æ¸¬ -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <div class="flex items-center gap-2 mb-4">
                            <div class="p-2 bg-blue-100 rounded-lg text-blue-600"><i data-lucide="baby" class="w-6 h-6"></i></div>
                            <h3 class="text-lg font-bold text-gray-800">USJ è¨­æ–½å¿«ç¯©</h3>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                èº«é«˜: <span class="text-blue-600 font-bold text-xl">${childHeight} cm</span>
                            </label>
                            <input type="range" min="80" max="140" value="${childHeight}" oninput="updateHeight(this.value)" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600">
                            <div class="flex justify-between text-xs text-gray-400 mt-1"><span>80cm</span><span>100cm</span><span>115cm</span><span>140cm</span></div>
                        </div>
                        <div class="grid grid-cols-1 gap-2">${rideHtml}</div>
                    </div>

                    <!-- è¨˜å¸³æœ¬ -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <div class="flex items-center gap-2 mb-4">
                            <div class="p-2 bg-yellow-100 rounded-lg text-yellow-600"><i data-lucide="dollar-sign" class="w-6 h-6"></i></div>
                            <h3 class="text-lg font-bold text-gray-800">ç°¡æ˜“è¨˜å¸³</h3>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg mb-4 flex gap-2">
                            <input type="text" id="ex-desc" placeholder="é …ç›®" class="flex-1 p-2 border border-gray-300 rounded-md text-sm">
                            <input type="number" id="ex-amount" placeholder="Â¥" class="w-20 p-2 border border-gray-300 rounded-md text-sm">
                            <button onclick="addExpense()" class="bg-blue-600 text-white p-2 rounded-md"><i data-lucide="plus" class="w-5 h-5"></i></button>
                        </div>
                        <div class="text-right text-sm text-gray-600">ç¸½æ”¯å‡º: <span class="text-2xl font-bold text-gray-800">Â¥ ${total.toLocaleString()}</span></div>
                        <div class="max-h-60 overflow-y-auto mt-2">${expenseList}</div>
                    </div>
                </div>
            `;
        }

        function updateHeight(val) { childHeight = parseInt(val); render(); }
        
        function addExpense() {
            const desc = document.getElementById('ex-desc').value;
            const amount = document.getElementById('ex-amount').value;
            if(!desc || !amount) return;
            expenses.unshift({ id: Date.now(), desc, amount: parseInt(amount), time: new Date().toLocaleTimeString('zh-TW', {hour:'2-digit', minute:'2-digit'}) });
            localStorage.setItem('osaka_expenses', JSON.stringify(expenses));
            render();
        }

        function deleteExpense(id) {
            expenses = expenses.filter(e => e.id !== id);
            localStorage.setItem('osaka_expenses', JSON.stringify(expenses));
            render();
        }

        // --- æ—¥èªå­¸ç¿’æ¸²æŸ“ ---
        function renderLearning(container) {
            const randomPhrase = DAILY_PHRASES[Math.floor(Math.random() * DAILY_PHRASES.length)];
            
            let categoriesHtml = LEARNING_DATA.map(cat => `
                <div class="border-t border-gray-100 pt-4 first:border-0 first:pt-0">
                    <h4 class="text-md font-bold mb-3 px-2 py-1 rounded inline-block ${cat.color}">${cat.cat}</h4>
                    <div class="grid grid-cols-2 gap-3 mb-4">
                        ${cat.words.map(w => `
                            <div onclick="speak('${w.jp}')" class="bg-gray-50 p-3 rounded-lg border border-gray-100 text-center active:scale-95 transition-transform cursor-pointer relative group">
                                <div class="absolute top-1 right-1 text-gray-300"><i data-lucide="volume-2" class="w-3 h-3"></i></div>
                                <div class="text-xl font-bold text-gray-800">${w.jp}</div>
                                <div class="text-sm text-gray-500">${w.ch}</div>
                            </div>
                        `).join('')}
                    </div>
                    <div onclick="speak('${cat.phrase.jp}')" class="bg-blue-50 p-3 rounded-lg border border-blue-100 flex items-start gap-3 cursor-pointer">
                        <div class="p-2 bg-blue-100 rounded-full text-blue-600 mt-1"><i data-lucide="play-circle" class="w-4 h-4"></i></div>
                        <div>
                            <div class="text-xs font-bold text-blue-500">æŒ‘æˆ°èªªä¸€å¥ï¼š</div>
                            <div class="text-lg font-bold text-gray-800">${cat.phrase.jp}</div>
                            <div class="text-sm text-blue-700">${cat.phrase.r}</div>
                            <div class="text-sm text-gray-500">${cat.phrase.ch}</div>
                        </div>
                    </div>
                </div>
            `).join('');

            container.innerHTML = `
                <div class="space-y-6 fade-in">
                    <!-- æ¯æ—¥ä¸€å¥ -->
                    <div class="bg-gradient-to-r from-pink-500 to-rose-500 p-4 rounded-xl shadow-md text-white text-center cursor-pointer" onclick="speak('${randomPhrase.jp}')">
                        <div class="flex justify-center items-center gap-2 mb-2">
                            <i data-lucide="star" class="text-yellow-300 fill-current w-5 h-5"></i>
                            <h3 class="text-lg font-bold">æ¯æ—¥ä¸€å¥æŒ‘æˆ° (é»æ“Šç™¼éŸ³)</h3>
                        </div>
                        <div class="text-3xl font-bold mb-1">${randomPhrase.jp}</div>
                        <div class="text-sm font-medium text-pink-100 mb-1">${randomPhrase.romaji}</div>
                        <div class="text-xl font-bold">${randomPhrase.ch}</div>
                    </div>
                    
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200">
                        ${categoriesHtml}
                    </div>
                </div>
            `;
        }

        // --- è¡Œå‰æ¸…å–®æ¸²æŸ“ ---
        function renderPacking(container) {
            container.innerHTML = `
                <div class="space-y-6 fade-in">
                    <h2 class="text-lg font-bold text-gray-800 px-1">è¡Œå‰æ¸…å–®</h2>
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <ul class="space-y-3">
                            <li class="flex items-center gap-3 text-sm text-gray-700"><input type="checkbox" class="w-5 h-5 accent-blue-600" checked> ä¸‹è¼‰ USJ å®˜æ–¹ APP</li>
                            <li class="flex items-center gap-3 text-sm text-gray-700"><input type="checkbox" class="w-5 h-5 accent-blue-600" checked> æº–å‚™ 100 åœ“ç¡¬å¹£</li>
                            <li class="flex items-center gap-3 text-sm text-gray-700"><input type="checkbox" class="w-5 h-5 accent-blue-600"> ç¢ºèªæ¼«éŠ/WiFi</li>
                            <li class="flex items-center gap-3 text-sm text-gray-700"><input type="checkbox" class="w-5 h-5 accent-blue-600"> å…’ç«¥è¼•ä¾¿é›¨è¡£</li>
                            <li class="flex items-center gap-3 text-sm text-gray-700"><input type="checkbox" class="w-5 h-5 accent-blue-600"> è­·ç…§ (æœ‰æ•ˆæœŸ6å€‹æœˆä»¥ä¸Š)</li>
                            <li class="flex items-center gap-3 text-sm text-gray-700"><input type="checkbox" class="w-5 h-5 accent-blue-600"> å¸¸ç”¨è—¥å“ (é€€ç‡’/è…¸èƒƒ)</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        // --- TTS èªéŸ³ ---
        function speak(text) {
            if (!window.speechSynthesis) { alert("ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³"); return; }
            window.speechSynthesis.cancel();
            const u = new SpeechSynthesisUtterance(text);
            u.lang = 'ja-JP'; u.rate = 0.9;
            window.speechSynthesis.speak(u);
        }
    </script>
</body>
</html>
